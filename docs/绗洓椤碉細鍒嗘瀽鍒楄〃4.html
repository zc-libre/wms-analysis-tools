<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EI分析 - 流通行业智能仓储管理系统分析工具</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome 图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js 图表库 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: "Microsoft YaHei", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        .top-bar {
            background-color: #fff;
            border-bottom: 1px solid #dee2e6;
            padding: 10px 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .system-title {
            font-weight: 600;
            color: #0d6efd;
            font-size: 1.1rem;
        }
        .sidebar {
            background-color: #fff;
            border-right: 1px solid #dee2e6;
            height: calc(100vh - 50px);
            overflow-y: auto;
            padding: 15px;
        }
        .main-content {
            height: calc(100vh - 50px);
            overflow-y: auto;
            padding: 15px;
        }
        .project-card {
            margin-bottom: 15px;
            border-left: 4px solid #0d6efd;
            transition: all 0.2s;
        }
        .project-card:hover {
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
        }
        .project-card.active {
            border-left: 4px solid #198754;
            background-color: #f0f8ff;
        }
        .analysis-item {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            transition: all 0.2s;
            background-color: #fff;
        }
        .analysis-item:hover {
            background-color: #f0f8ff;
            border-color: #bee5eb;
        }
        .analysis-item.active {
            background-color: #e9f7fe;
            border-left: 3px solid #0d6efd;
        }
        .analysis-item .status-badge {
            font-size: 0.75rem;
            padding: 2px 6px;
        }
        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
            border: none;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .card-header {
            background-color: #fff;
            border-bottom: 1px solid rgba(0,0,0,.125);
            padding: 15px 20px;
        }
        .form-select, .form-control {
            border-radius: 4px;
        }
        .badge {
            padding: 6px 10px;
            font-weight: 500;
            border-radius: 4px;
        }
        .nav-tabs .nav-link {
            color: #495057;
            font-weight: 500;
        }
        .nav-tabs .nav-link.active {
            color: #0d6efd;
            font-weight: 600;
            border-bottom: 2px solid #0d6efd;
        }
        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
            white-space: nowrap;
        }
        .table td {
            vertical-align: middle;
        }
        .conclusion-table th, .conclusion-table td {
            text-align: center;
            white-space: nowrap;
        }
        .table-sm th, .table-sm td {
            padding: 0.5rem;
        }
        .chart-container {
            max-width: 500px;
            max-height: 500px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.05);
        }
        .chart-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            color: #333;
        }
        .pagination {
            margin-top: 20px;
            justify-content: center;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        .btn-xs {
            padding: 0.1rem 0.5rem;
            font-size: 0.75rem;
        }
        .analysis-actions {
            gap: 5px;
        }
        .tab-content {
            padding-top: 20px;
        }
        .table-responsive {
            max-height: 600px;
        }
        /* 添加的下拉菜单样式 */
        .more-dropdown-menu {
            min-width: 200px;
        }
        .more-dropdown-item {
            padding: 8px 16px;
        }
        .more-dropdown-item:hover {
            background-color: #f0f7ff;
        }
        .more-dropdown-item.active {
            background-color: #e6f2ff;
            color: #0d6efd;
            font-weight: 500;
        }
        /* 下拉菜单位置 */
        .nav-tabs .dropdown-menu {
            margin-top: 0;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- 顶部导航栏 -->
    <div class="top-bar d-flex justify-content-between align-items-center">
        <div class="system-title">流通行业智能仓储管理系统分析工具</div>
        <div>
            <span class="me-3">欢迎，管理员</span>
            <a href="#" class="text-decoration-none"><i class="fas fa-sign-out-alt"></i> 退出</a>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <!-- 左侧边栏 -->
            <div class="col-md-3 col-lg-2 sidebar">
                <!-- 项目信息区域 -->
                <div class="mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">项目信息</h5>
                        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#newAnalysisModal">
                            <i class="fas fa-plus"></i> 新建分析
                        </button>
                    </div>
                    <!-- 项目列表 -->
                    <div class="project-list">
                        <div class="project-card card active">
                            <div class="card-body p-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="card-title mb-1" title="南京物流中心项目">南京物流中心项目</h6>
                                    <div>
                                        <button class="btn btn-sm btn-link text-primary p-0" title="展开分析记录">
                                            <i class="fas fa-chevron-down"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="text-muted small">
                                    <div>江苏分公司 | 南京市江宁区</div>
                                </div>
                            </div>
                        </div>
                        <div class="project-card card">
                            <div class="card-body p-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="card-title mb-1" title="上海配送中心项目">上海配送中心项目</h6>
                                    <div>
                                        <button class="btn btn-sm btn-link text-primary p-0" title="展开分析记录">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="text-muted small">
                                    <div>上海分公司 | 上海市嘉定区</div>
                                </div>
                            </div>
                        </div>
                        <div class="project-card card">
                            <div class="card-body p-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="card-title mb-1" title="广州配送中心项目">广州配送中心项目</h6>
                                    <div>
                                        <button class="btn btn-sm btn-link text-primary p-0" title="展开分析记录">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="text-muted small">
                                    <div>广东分公司 | 广州市番禺区</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 分析记录区域 -->
                <div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">分析记录</h5>
                        <div>
                            <button class="btn btn-sm btn-outline-danger" title="批量删除">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                    <!-- 分析记录列表 -->
                    <div class="analysis-list">
                        <div class="analysis-item active">
                            <div class="d-flex justify-content-between">
                                <span class="text-truncate">南京3月销售订单分析</span>
                                <span class="badge bg-success status-badge">已完成</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <small class="text-muted">2025-03-27 14:30</small>
                                <div class="d-flex analysis-actions">
                                    <button class="btn btn-outline-primary btn-xs" title="查看" data-analysis-id="1">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-danger btn-xs" title="删除" data-analysis-id="1">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="analysis-item">
                            <div class="d-flex justify-content-between">
                                <span class="text-truncate">南京2月销售订单分析</span>
                                <span class="badge bg-success status-badge">已完成</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <small class="text-muted">2025-02-15 10:20</small>
                                <div class="d-flex analysis-actions">
                                    <button class="btn btn-outline-primary btn-xs" title="查看" data-analysis-id="2">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-danger btn-xs" title="删除" data-analysis-id="2">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="analysis-item">
                            <div class="d-flex justify-content-between">
                                <span class="text-truncate">南京1月销售订单分析</span>
                                <span class="badge bg-warning status-badge">分析中</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <small class="text-muted">2025-01-20 09:15</small>
                                <div class="d-flex analysis-actions">
                                    <button class="btn btn-outline-secondary btn-xs" title="暂停" data-analysis-id="3">
                                        <i class="fas fa-pause"></i>
                                    </button>
                                    <button class="btn btn-outline-danger btn-xs" title="删除" data-analysis-id="3">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 右侧主内容区域 -->
            <div class="col-md-9 col-lg-10 main-content">
                <!-- 分析结果头部 -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4>南京3月销售订单分析</h4>
                    <div class="action-buttons">
                        <button class="btn btn-outline-secondary">
                            <i class="fas fa-redo me-1"></i> 重新分析
                        </button>
                        <div class="dropdown d-inline-block">
                            <button class="btn btn-outline-primary dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-download me-1"></i> 导出
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="exportDropdown">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-table me-2"></i> 导出分析明细</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-file-word me-2"></i> 导出分析报告(Word)</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-file-powerpoint me-2"></i> 导出分析报告(PPT)</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 命中率分析结论 -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">命中率分析结论</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm conclusion-table mb-0">
                                <thead>
                                    <tr>
                                        <th rowspan="2">日期类型</th>
                                        <th rowspan="2">日期</th>
                                        <th rowspan="2">时效模式</th>
                                        <th rowspan="2">全天总订单行</th>
                                        <th rowspan="2">全天总容器搬运次数</th>
                                        <th colspan="3">全天平均</th>
                                        <th colspan="3">建议规划产能</th>
                                    </tr>
                                    <tr>
                                        <th>订单行/h</th>
                                        <th>容器搬运次数/h</th>
                                        <th>平均命中率(行)</th>
                                        <th>订单行/h</th>
                                        <th>容器搬运次数/h</th>
                                        <th>平均命中率(行)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>中值日</td>
                                        <td>2025-03-06</td>
                                        <td>天</td>
                                        <td>2500</td>
                                        <td>1152</td>
                                        <td>25</td>
                                        <td>288</td>
                                        <td>2.17</td>
                                        <td>767</td>
                                        <td>352</td>
                                        <td>2.18</td>
                                    </tr>
                                    <tr>
                                        <td>均值日</td>
                                        <td>2025-03-06</td>
                                        <td>天</td>
                                        <td>2500</td>
                                        <td>1152</td>
                                        <td>625</td>
                                        <td>288</td>
                                        <td>2.17</td>
                                        <td>767</td>
                                        <td>352</td>
                                        <td>2.18</td>
                                    </tr>
                                    <tr>
                                        <td>峰值日</td>
                                        <td>2025-03-07</td>
                                        <td>天</td>
                                        <td>2700</td>
                                        <td>1262</td>
                                        <td>85</td>
                                        <td>316</td>
                                        <td>2.17</td>
                                        <td>840</td>
                                        <td>382</td>
                                        <td>2.18</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 分析数据选项卡 -->
                <div class="card">
                    <div class="card-header bg-white">
                        <ul class="nav nav-tabs card-header-tabs" id="analysisTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="daily-eiq-tab" data-bs-toggle="tab" data-bs-target="#daily-eiq" type="button" role="tab" aria-controls="daily-eiq" aria-selected="false">每日EIQ分析</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="hourly-eiq-tab" data-bs-toggle="tab" data-bs-target="#hourly-eiq" type="button" role="tab" aria-controls="hourly-eiq" aria-selected="false">每时段EIQ分析</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="order-structure-tab" data-bs-toggle="tab" data-bs-target="#order-structure" type="button" role="tab" aria-controls="order-structure" aria-selected="false">订单结构分析</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="ei-analysis-tab" data-bs-toggle="tab" data-bs-target="#ei-analysis" type="button" role="tab" aria-controls="ei-analysis" aria-selected="true">EI分析</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="eq-analysis-tab" data-bs-toggle="tab" data-bs-target="#eq-analysis" type="button" role="tab" aria-controls="eq-analysis" aria-selected="false">EQ分析</button>
                            </li>
                            <!-- 更多下拉菜单 -->
                            <li class="nav-item dropdown" role="presentation">
                                <button class="nav-link dropdown-toggle" id="more-analysis-tab" data-bs-toggle="dropdown" aria-expanded="false">
                                    更多 <i class="fas fa-caret-down ms-1"></i>
                                </button>
                                <ul class="dropdown-menu more-dropdown-menu" aria-labelledby="more-analysis-tab">
                                    <li>
                                        <a class="dropdown-item more-dropdown-item" id="single-product-tab" data-bs-toggle="tab" data-bs-target="#single-product" role="tab">
                                            <i class="fas fa-box me-2"></i> 单品分析
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item more-dropdown-item" id="sales-movement-tab" data-bs-toggle="tab" data-bs-target="#sales-movement" role="tab">
                                            <i class="fas fa-chart-line me-2"></i> 动销分析
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item more-dropdown-item" id="hit-rate-conclusion-tab" data-bs-toggle="tab" data-bs-target="#hit-rate-conclusion" role="tab">
                                            <i class="fas fa-bullseye me-2"></i> 命中率分析结论
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item more-dropdown-item" id="overall-hit-rate-tab" data-bs-toggle="tab" data-bs-target="#overall-hit-rate" role="tab">
                                            <i class="fas fa-chart-bar me-2"></i> 整体命中率
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item more-dropdown-item" id="overall-hit-rate-detail-tab" data-bs-toggle="tab" data-bs-target="#overall-hit-rate-detail" role="tab">
                                            <i class="fas fa-list-ul me-2"></i> 整体命中率明细
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item more-dropdown-item" id="workstation-hit-rate-tab" data-bs-toggle="tab" data-bs-target="#workstation-hit-rate" role="tab">
                                            <i class="fas fa-desktop me-2"></i> 工作站命中率
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item more-dropdown-item" id="workstation-hit-rate-detail-tab" data-bs-toggle="tab" data-bs-target="#workstation-hit-rate-detail" role="tab">
                                            <i class="fas fa-clipboard-list me-2"></i> 工作站命中率明细
                                        </a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="analysisTabContent">
                            <!-- 每日EIQ分析选项卡 -->
                            <div class="tab-pane fade" id="daily-eiq" role="tabpanel" aria-labelledby="daily-eiq-tab">
                                <div class="text-center py-4">
                                    <i class="fas fa-calendar-day fa-3x text-primary mb-3"></i>
                                    <h5>每日EIQ分析</h5>
                                    <p class="text-muted">请切换到"EI分析"选项卡查看详细数据</p>
                                </div>
                            </div>
                            
                            <!-- 每时段EIQ分析选项卡 -->
                            <div class="tab-pane fade" id="hourly-eiq" role="tabpanel" aria-labelledby="hourly-eiq-tab">
                                <div class="text-center py-4">
                                    <i class="fas fa-clock fa-3x text-primary mb-3"></i>
                                    <h5>每时段EIQ分析</h5>
                                    <p class="text-muted">请切换到"EI分析"选项卡查看详细数据</p>
                                </div>
                            </div>
                            
                            <!-- 订单结构分析选项卡 -->
                            <div class="tab-pane fade" id="order-structure" role="tabpanel" aria-labelledby="order-structure-tab">
                                <div class="text-center py-4">
                                    <i class="fas fa-sitemap fa-3x text-primary mb-3"></i>
                                    <h5>订单结构分析</h5>
                                    <p class="text-muted">请切换到"EI分析"选项卡查看详细数据</p>
                                </div>
                            </div>
                            
                            <!-- EI分析选项卡 -->
                            <div class="tab-pane fade show active" id="ei-analysis" role="tabpanel" aria-labelledby="ei-analysis-tab">
                                <div class="d-flex justify-content-between mb-3">
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-primary active view-toggle" data-view="table">表格视图</button>
                                        <button type="button" class="btn btn-outline-primary view-toggle" data-view="chart">图表视图</button>
                                    </div>
                                    <div>
                                        <button class="btn btn-outline-secondary">
                                            <i class="fas fa-download me-1"></i> 导出数据
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- 表格视图 -->
                                <div class="table-view">
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-hover">
                                            <thead>
                                                <tr>
                                                    <th>编号</th>
                                                    <th>订单行数</th>
                                                    <th>单据数量</th>
                                                    <th>单据数量占比</th>
                                                </tr>
                                            </thead>
                                            <tbody id="eiAnalysisTable">
                                                <!-- 表格数据将在JavaScript中动态填充 -->
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <!-- 分页控件 -->
                                    <nav aria-label="EI分析分页">
                                        <ul class="pagination" id="eiAnalysisPagination">
                                            <!-- 分页按钮将在JavaScript中动态填充 -->
                                        </ul>
                                    </nav>
                                </div>
                                
                                <!-- 图表视图 -->
                                <div class="chart-view" style="display: none;">
                                    <div class="chart-container">
                                        <div class="chart-title">订单行数与单据数量分布</div>
                                        <canvas id="eiAnalysisChart"></canvas>
                                    </div>
                                    <div class="text-center mt-3">
                                        <small class="text-muted">本图表根据订单行数区间展示单据数量分布情况</small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- EQ分析选项卡 -->
                            <div class="tab-pane fade" id="eq-analysis" role="tabpanel" aria-labelledby="eq-analysis-tab">
                                <div class="text-center py-4">
                                    <i class="fas fa-chart-area fa-3x text-primary mb-3"></i>
                                    <h5>EQ分析</h5>
                                    <p class="text-muted">请切换到"EI分析"选项卡查看详细数据</p>
                                </div>
                            </div>
                            
                            <!-- 更多下拉菜单选项卡 -->
                            <div class="tab-pane fade" id="single-product" role="tabpanel" aria-labelledby="single-product-tab">
                                <div class="text-center py-4">
                                    <i class="fas fa-box fa-3x text-primary mb-3"></i>
                                    <h5>单品分析</h5>
                                    <p class="text-muted">请切换到"EI分析"选项卡查看详细数据</p>
                                </div>
                            </div>
                            
                            <div class="tab-pane fade" id="sales-movement" role="tabpanel" aria-labelledby="sales-movement-tab">
							                            <div class="tab-pane fade" id="sales-movement" role="tabpanel" aria-labelledby="sales-movement-tab">
                                <div class="text-center py-4">
                                    <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                                    <h5>动销分析</h5>
                                    <p class="text-muted">请切换到"EI分析"选项卡查看详细数据</p>
                                </div>
                            </div>
                            
                            <div class="tab-pane fade" id="hit-rate-conclusion" role="tabpanel" aria-labelledby="hit-rate-conclusion-tab">
                                <div class="text-center py-4">
                                    <i class="fas fa-bullseye fa-3x text-primary mb-3"></i>
                                    <h5>命中率分析结论</h5>
                                    <p class="text-muted">请切换到"EI分析"选项卡查看详细数据</p>
                                </div>
                            </div>
                            
                            <div class="tab-pane fade" id="overall-hit-rate" role="tabpanel" aria-labelledby="overall-hit-rate-tab">
                                <div class="text-center py-4">
                                    <i class="fas fa-chart-bar fa-3x text-primary mb-3"></i>
                                    <h5>整体命中率</h5>
                                    <p class="text-muted">请切换到"EI分析"选项卡查看详细数据</p>
                                </div>
                            </div>
                            
                            <div class="tab-pane fade" id="overall-hit-rate-detail" role="tabpanel" aria-labelledby="overall-hit-rate-detail-tab">
                                <div class="text-center py-4">
                                    <i class="fas fa-list-ul fa-3x text-primary mb-3"></i>
                                    <h5>整体命中率明细</h5>
                                    <p class="text-muted">请切换到"EI分析"选项卡查看详细数据</p>
                                </div>
                            </div>
                            
                            <div class="tab-pane fade" id="workstation-hit-rate" role="tabpanel" aria-labelledby="workstation-hit-rate-tab">
                                <div class="text-center py-4">
                                    <i class="fas fa-desktop fa-3x text-primary mb-3"></i>
                                    <h5>工作站命中率</h5>
                                    <p class="text-muted">请切换到"EI分析"选项卡查看详细数据</p>
                                </div>
                            </div>
                            
                            <div class="tab-pane fade" id="workstation-hit-rate-detail" role="tabpanel" aria-labelledby="workstation-hit-rate-detail-tab">
                                <div class="text-center py-4">
                                    <i class="fas fa-clipboard-list fa-3x text-primary mb-3"></i>
                                    <h5>工作站命中率明细</h5>
                                    <p class="text-muted">请切换到"EI分析"选项卡查看详细数据</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 新建分析模态框 -->
    <div class="modal fade" id="newAnalysisModal" tabindex="-1" aria-labelledby="newAnalysisModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newAnalysisModalLabel">新建分析</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="analysisName" class="form-label">分析名称</label>
                        <input type="text" class="form-control" id="analysisName" placeholder="请输入分析名称" required>
                    </div>
                    <div class="mb-3">
                        <label for="projectSelect" class="form-label">选择项目</label>
                        <select class="form-select" id="projectSelect" required>
                            <option value="" selected disabled>请选择项目</option>
                            <option value="1">南京物流中心项目</option>
                            <option value="2">上海配送中心项目</option>
                            <option value="3">广州配送中心项目</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">分析范围</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="analysisScope" id="scopeProject" checked>
                            <label class="form-check-label" for="scopeProject">
                                按项目分析（分析该项目下的所有订单数据）
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="analysisScope" id="scopeFiles">
                            <label class="form-check-label" for="scopeFiles">
                                选择特定文件分析
                            </label>
                        </div>
                    </div>
                    <div id="fileSelectionArea" class="mb-3" style="display: none;">
                        <label class="form-label">选择文件</label>
                        <div class="list-group">
                            <label class="list-group-item">
                                <input class="form-check-input me-1" type="checkbox" value="">
                                销售出库订单_202503.xlsx
                            </label>
                            <label class="list-group-item">
                                <input class="form-check-input me-1" type="checkbox" value="">
                                销售出库订单_202502.xlsx
                            </label>
                            <label class="list-group-item">
                                <input class="form-check-input me-1" type="checkbox" value="">
                                销售出库订单_202501.xlsx
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary">提交分析</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS 和 Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // EI分析数据
            const eiAnalysisData = [
                { id: 1, orderLines: 1, orderCount: 17, percentage: 0.016569201 },
                { id: 2, orderLines: 2, orderCount: 1, percentage: 0.000974659 },
                { id: 3, orderLines: 4, orderCount: 1, percentage: 0.000974659 },
                { id: 4, orderLines: 17, orderCount: 1, percentage: 0.000974659 },
                { id: 5, orderLines: 24, orderCount: 1, percentage: 0.000974659 },
                { id: 6, orderLines: 30, orderCount: 1, percentage: 0.000974659 },
                { id: 7, orderLines: 38, orderCount: 1, percentage: 0.000974659 },
                { id: 8, orderLines: 45, orderCount: 1, percentage: 0.000974659 },
                { id: 9, orderLines: 46, orderCount: 1, percentage: 0.000974659 },
                { id: 10, orderLines: 50, orderCount: 1, percentage: 0.000974659 },
                { id: 11, orderLines: 56, orderCount: 1, percentage: 0.000974659 },
                { id: 12, orderLines: 62, orderCount: 1, percentage: 0.000974659 },
                { id: 13, orderLines: 67, orderCount: 1, percentage: 0.000974659 },
                { id: 14, orderLines: 68, orderCount: 1, percentage: 0.000974659 },
                { id: 15, orderLines: 69, orderCount: 1, percentage: 0.000974659 },
                { id: 16, orderLines: 70, orderCount: 1, percentage: 0.000974659 },
                { id: 17, orderLines: 74, orderCount: 1, percentage: 0.000974659 },
                { id: 18, orderLines: 75, orderCount: 1, percentage: 0.000974659 },
                { id: 19, orderLines: 77, orderCount: 1, percentage: 0.000974659 },
                { id: 20, orderLines: 81, orderCount: 2, percentage: 0.001949318 },
                { id: 21, orderLines: 84, orderCount: 2, percentage: 0.001949318 },
                { id: 22, orderLines: 86, orderCount: 1, percentage: 0.000974659 },
                { id: 23, orderLines: 89, orderCount: 1, percentage: 0.000974659 },
                { id: 24, orderLines: 90, orderCount: 1, percentage: 0.000974659 },
                { id: 25, orderLines: 93, orderCount: 2, percentage: 0.001949318 },
                { id: 26, orderLines: 94, orderCount: 1, percentage: 0.000974659 },
                { id: 27, orderLines: 95, orderCount: 1, percentage: 0.000974659 },
                { id: 28, orderLines: 97, orderCount: 1, percentage: 0.000974659 },
                { id: 29, orderLines: 98, orderCount: 1, percentage: 0.000974659 },
                { id: 30, orderLines: 99, orderCount: 2, percentage: 0.001949318 },
                { id: 31, orderLines: 100, orderCount: 3, percentage: 0.002923977 },
                { id: 32, orderLines: 105, orderCount: 1, percentage: 0.000974659 },
                { id: 33, orderLines: 110, orderCount: 2, percentage: 0.001949318 },
                { id: 34, orderLines: 112, orderCount: 1, percentage: 0.000974659 },
                { id: 35, orderLines: 115, orderCount: 1, percentage: 0.000974659 },
                { id: 36, orderLines: 120, orderCount: 3, percentage: 0.002923977 },
                { id: 37, orderLines: 125, orderCount: 2, percentage: 0.001949318 },
                { id: 38, orderLines: 130, orderCount: 1, percentage: 0.000974659 },
                { id: 39, orderLines: 135, orderCount: 2, percentage: 0.001949318 },
                { id: 40, orderLines: 140, orderCount: 2, percentage: 0.001949318 },
                { id: 41, orderLines: 145, orderCount: 1, percentage: 0.000974659 },
                { id: 42, orderLines: 150, orderCount: 3, percentage: 0.002923977 },
                { id: 43, orderLines: 155, orderCount: 2, percentage: 0.001949318 },
                { id: 44, orderLines: 160, orderCount: 2, percentage: 0.001949318 },
                { id: 45, orderLines: 165, orderCount: 1, percentage: 0.000974659 },
                { id: 46, orderLines: 170, orderCount: 2, percentage: 0.001949318 },
                { id: 47, orderLines: 175, orderCount: 1, percentage: 0.000974659 },
                { id: 48, orderLines: 180, orderCount: 3, percentage: 0.002923977 },
                { id: 49, orderLines: 185, orderCount: 2, percentage: 0.001949318 },
                { id: 50, orderLines: 190, orderCount: 1, percentage: 0.000974659 }
            ];
            
            // 分页配置
            const itemsPerPage = 10;
            let currentPage = 1;
            
            // 渲染EI分析表格数据
            function renderEiTable(page) {
                const tableBody = document.getElementById('eiAnalysisTable');
                tableBody.innerHTML = ''; // 清空表格内容
                
                const startIndex = (page - 1) * itemsPerPage;
                const endIndex = Math.min(startIndex + itemsPerPage, eiAnalysisData.length);
                
                for (let i = startIndex; i < endIndex; i++) {
                    const item = eiAnalysisData[i];
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${item.id}</td>
                        <td>${item.orderLines}</td>
                        <td>${item.orderCount}</td>
                        <td>${item.percentage.toFixed(9)}</td>
                    `;
                    
                    tableBody.appendChild(row);
                };
                
                // 更新分页控件
                renderPagination(page);
            }
            
            // 渲染分页控件
            function renderPagination(currentPage) {
                const paginationElement = document.getElementById('eiAnalysisPagination');
                paginationElement.innerHTML = '';
                
                const totalPages = Math.ceil(eiAnalysisData.length / itemsPerPage);
                
                // 添加上一页按钮
                const prevPageItem = document.createElement('li');
                prevPageItem.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
                
                const prevPageLink = document.createElement('a');
                prevPageLink.className = 'page-link';
                prevPageLink.href = '#';
                prevPageLink.setAttribute('aria-label', '上一页');
                prevPageLink.innerHTML = '<span aria-hidden="true">&laquo;</span>';
                
                if (currentPage > 1) {
                    prevPageLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        renderEiTable(currentPage - 1);
                    });
                }
                
                prevPageItem.appendChild(prevPageLink);
                paginationElement.appendChild(prevPageItem);
                
                // 添加页码按钮
                let startPage = Math.max(currentPage - 2, 1);
                let endPage = Math.min(startPage + 4, totalPages);
                
                if (endPage - startPage < 4) {
                    startPage = Math.max(endPage - 4, 1);
                }
                
                for (let i = startPage; i <= endPage; i++) {
                    const pageItem = document.createElement('li');
                    pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
                    
                    const pageLink = document.createElement('a');
                    pageLink.className = 'page-link';
                    pageLink.href = '#';
                    pageLink.textContent = i;
                    
                    pageLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        renderEiTable(i);
                    });
                    
                    pageItem.appendChild(pageLink);
                    paginationElement.appendChild(pageItem);
                }
                
                // 添加下一页按钮
                const nextPageItem = document.createElement('li');
                nextPageItem.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
                
                const nextPageLink = document.createElement('a');
                nextPageLink.className = 'page-link';
                nextPageLink.href = '#';
                nextPageLink.setAttribute('aria-label', '下一页');
                nextPageLink.innerHTML = '<span aria-hidden="true">&raquo;</span>';
                
                if (currentPage < totalPages) {
                    nextPageLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        renderEiTable(currentPage + 1);
                    });
                }
                
                nextPageItem.appendChild(nextPageLink);
                paginationElement.appendChild(nextPageItem);
            }
            
            // 初始化渲染EI分析表格
            renderEiTable(currentPage);
            
            // 构建EI分析的图表数据（根据订单行数分组）
            function prepareChartData() {
                // 定义订单行数区间
                const ranges = [
                    { label: '1-20', min: 1, max: 20, count: 0 },
                    { label: '21-40', min: 21, max: 40, count: 0 },
                    { label: '41-60', min: 41, max: 60, count: 0 },
                    { label: '61-80', min: 61, max: 80, count: 0 },
                    { label: '81-100', min: 81, max: 100, count: 0 },
                    { label: '101-120', min: 101, max: 120, count: 0 },
                    { label: '121-140', min: 121, max: 140, count: 0 },
                    { label: '141-160', min: 141, max: 160, count: 0 },
                    { label: '161-180', min: 161, max: 180, count: 0 },
                    { label: '181-200', min: 181, max: 200, count: 0 },
                    { label: '>200', min: 201, max: Infinity, count: 0 }
                ];
                
                // 统计每个区间的单据数量
                eiAnalysisData.forEach(item => {
                    const range = ranges.find(r => item.orderLines >= r.min && item.orderLines <= r.max);
                    if (range) {
                        range.count += item.orderCount;
                    }
                });
                
                // 只返回有数据的区间
                const filteredRanges = ranges.filter(r => r.count > 0);
                
                return {
                    labels: filteredRanges.map(r => r.label),
                    values: filteredRanges.map(r => r.count)
                };
            }
            
            // 创建饼图
            function createEiChart() {
                const chartData = prepareChartData();
                const ctx = document.getElementById('eiAnalysisChart').getContext('2d');
                
                return new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: chartData.labels,
                        datasets: [{
                            data: chartData.values,
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.7)',
                                'rgba(54, 162, 235, 0.7)',
                                'rgba(255, 206, 86, 0.7)',
                                'rgba(75, 192, 192, 0.7)',
                                'rgba(153, 102, 255, 0.7)',
                                'rgba(255, 159, 64, 0.7)',
                                'rgba(199, 199, 199, 0.7)',
                                'rgba(83, 102, 255, 0.7)',
                                'rgba(40, 159, 164, 0.7)',
                                'rgba(210, 105, 30, 0.7)',
                                'rgba(128, 0, 128, 0.7)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    font: {
                                        size: 12
                                    },
                                    boxWidth: 15
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = Math.round((value / total * 100) * 100) / 100;
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // 初始化EI分析图表（延迟创建，因为最初是隐藏的）
            let eiChart = null;
            
            // 视图切换功能
            const viewToggleButtons = document.querySelectorAll('.view-toggle');
            viewToggleButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const viewType = this.getAttribute('data-view');
                    const tabPane = this.closest('.tab-pane');
                    
                    // 切换按钮状态
                    const toggleGroup = this.closest('.btn-group').querySelectorAll('.view-toggle');
                    toggleGroup.forEach(btn => {
                        btn.classList.remove('active', 'btn-primary');
                        btn.classList.add('btn-outline-primary');
                    });
                    this.classList.remove('btn-outline-primary');
                    this.classList.add('active', 'btn-primary');
                    
                    // 切换视图
                    const tableView = tabPane.querySelector('.table-view');
                    const chartView = tabPane.querySelector('.chart-view');
                    
                    if (viewType === 'table') {
                        tableView.style.display = 'block';
                        chartView.style.display = 'none';
                    } else {
                        tableView.style.display = 'none';
                        chartView.style.display = 'block';
                        
                        // 如果是第一次切换到图表视图，创建图表
                        if (!eiChart && tabPane.id === 'ei-analysis') {
                            setTimeout(() => {
                                eiChart = createEiChart();
                            }, 50);
                        } else if (eiChart) {
                            // 如果图表已存在，更新它
                            setTimeout(() => {
                                eiChart.update();
                            }, 50);
                        }
                    }
                });
            });
            
            // 项目卡片点击事件
            const projectCards = document.querySelectorAll('.project-card');
            projectCards.forEach(card => {
                card.addEventListener('click', function() {
                    projectCards.forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 切换展开/折叠图标
                    const icon = this.querySelector('.fa-chevron-right, .fa-chevron-down');
                    if (icon) {
                        if (icon.classList.contains('fa-chevron-right')) {
                            icon.classList.remove('fa-chevron-right');
                            icon.classList.add('fa-chevron-down');
                        } else {
                            // 如果当前已经是展开状态，则保持不变
                        }
                    }
                    
                    // 其他项目折叠
                    projectCards.forEach(c => {
                        if (c !== this) {
                            const otherIcon = c.querySelector('.fa-chevron-down');
                            if (otherIcon) {
                                otherIcon.classList.remove('fa-chevron-down');
                                otherIcon.classList.add('fa-chevron-right');
                            }
                        }
                    });
                });
            });
            
            // 分析记录点击事件
            const analysisItems = document.querySelectorAll('.analysis-item');
            analysisItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    // 如果点击的是按钮，不触发选择事件
                    if (e.target.closest('.btn-xs')) {
                        return;
                    }
                    
                    analysisItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // 分析范围单选按钮切换文件选择区域显示
            const scopeRadios = document.querySelectorAll('input[name="analysisScope"]');
            const fileSelectionArea = document.getElementById('fileSelectionArea');
            
            scopeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.id === 'scopeFiles') {
                        fileSelectionArea.style.display = 'block';
                    } else {
                        fileSelectionArea.style.display = 'none';
                    }
                });
            });
            
            // 导出数据按钮点击事件
            const exportDataButton = document.querySelector('.btn-outline-secondary');
            if (exportDataButton) {
                exportDataButton.addEventListener('click', function() {
                    alert('正在导出数据，请稍候...');
                });
            }
        });
    </script>
</body>
</html>